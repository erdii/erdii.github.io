<!doctype html><html lang=en-us><head><meta name=generator content="Hugo 0.72.0"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>TIL: How to store and restore the state of multiple entities in Home Assistant | Shared thoughts</title><meta name=description content="Short howto: store/restore state in HA"><meta name=keywords content="til,home-assistant,smart-home"><meta name=author content="erdii"><meta property="og:title" content="TIL: How to store and restore the state of multiple entities in Home Assistant"><meta property="og:description" content="Short howto: store/restore state in HA"><meta property="og:type" content="article"><meta property="og:url" content="https://erdii.engineering/post/2021-03-10-til-how-to-store-and-restore-state-in-home-assistant/"><meta property="article:published_time" content="2021-03-10T20:00:00+01:00"><meta property="article:modified_time" content="2021-03-10T20:00:00+01:00"><meta name=theme-color content="#000"><link rel=canonical href=https://erdii.engineering/post/2021-03-10-til-how-to-store-and-restore-state-in-home-assistant/><link rel=icon sizes=any href="data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgNDYgNDUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHRpdGxlPkFmdGVyIERhcms8L3RpdGxlPjxwYXRoIGQ9Ik0uNzA4IDQ1IDIzIC40MTYgNDUuMjkyIDQ1SC43MDh6TTM1IDM4IDIzIDE5IDExIDM4aDI0eiIgZmlsbD0iIzAwMCIvPjwvc3ZnPg=="><style>html{font-size:12px}*{box-sizing:border-box;text-rendering:geometricPrecision}body{font-size:1rem;line-height:1.5rem;margin:0;font-family:Menlo,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New,monospace,serif;word-wrap:break-word}h1,h2,h3,h4,h5,h6{line-height:1.3em}fieldset{border:none;padding:0;margin:0}pre{padding:2rem;margin:1.75rem 0;background-color:#fff;border:1px solid #ccc;overflow:auto}code[class*=language-],pre[class*=language-],pre code{font-weight:100;text-shadow:none;margin:1.75rem 0}a{cursor:pointer;color:#ff2e88;text-decoration:none;border-bottom:1px solid #ff2e88}a:hover{background-color:#ff2e88;color:#fff}.grid{display:-ms-flexbox;display:flex;-ms-flex-wrap:wrap;flex-wrap:wrap}.grid.\-top{-ms-flex-align:start;-ms-grid-row-align:flex-start;align-items:flex-start}.grid.\-middle{-ms-flex-align:center;-ms-grid-row-align:center;align-items:center}.grid.\-bottom{-ms-flex-align:end;-ms-grid-row-align:flex-end;align-items:flex-end}.grid.\-stretch{-ms-flex-align:stretch;-ms-grid-row-align:stretch;align-items:stretch}.grid.\-baseline{-ms-flex-align:baseline;-ms-grid-row-align:baseline;align-items:baseline}.grid.\-left{-ms-flex-pack:start;justify-content:flex-start}.grid.\-center{-ms-flex-pack:center;justify-content:center}.grid.\-right{-ms-flex-pack:end;justify-content:flex-end}.grid.\-between{-ms-flex-pack:justify;justify-content:space-between}.grid.\-around{-ms-flex-pack:distribute;justify-content:space-around}.cell{-ms-flex:1;flex:1;box-sizing:border-box}@media screen and (min-width:768px){.cell.\-1of12{-ms-flex:0 0 8.33333%;flex:0 0 8.33333%}.cell.\-2of12{-ms-flex:0 0 16.66667%;flex:0 0 16.66667%}.cell.\-3of12{-ms-flex:0 0 25%;flex:0 0 25%}.cell.\-4of12{-ms-flex:0 0 33.33333%;flex:0 0 33.33333%}.cell.\-5of12{-ms-flex:0 0 41.66667%;flex:0 0 41.66667%}.cell.\-6of12{-ms-flex:0 0 50%;flex:0 0 50%}.cell.\-7of12{-ms-flex:0 0 58.33333%;flex:0 0 58.33333%}.cell.\-8of12{-ms-flex:0 0 66.66667%;flex:0 0 66.66667%}.cell.\-9of12{-ms-flex:0 0 75%;flex:0 0 75%}.cell.\-10of12{-ms-flex:0 0 83.33333%;flex:0 0 83.33333%}.cell.\-11of12{-ms-flex:0 0 91.66667%;flex:0 0 91.66667%}}@media screen and (max-width:768px){.grid{-ms-flex-direction:column;flex-direction:column}.cell{-ms-flex:0 0 auto;flex:0 0 auto}}.hack,.hack blockquote,.hack code,.hack em,.hack h1,.hack h2,.hack h3,.hack h4,.hack h5,.hack h6,.hack strong{font-size:1rem;font-style:normal;font-family:Menlo,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New,monospace,serif}.hack blockquote,.hack code,.hack em,.hack strong{line-height:20px}.hack blockquote,.hack code,.hack footer,.hack h1,.hack h2,.hack h3,.hack h4,.hack h5,.hack h6,.hack header,.hack li,.hack ol,.hack p,.hack section,.hack ul{float:none;margin:0;padding:0}.hack blockquote,.hack h1,.hack ol,.hack p,.hack ul{margin-top:20px;margin-bottom:20px}.hack h1{position:relative;display:inline-block;display:table-cell;padding:20px 0 30px;margin:0;overflow:hidden}.hack h1:after{content:"====================================================================================================";position:absolute;bottom:10px;left:0}.hack h1+*{margin-top:0}.hack h2,.hack h3,.hack h4,.hack h5,.hack h6{position:relative;margin-bottom:1.75rem}.hack h2:before,.hack h3:before,.hack h4:before,.hack h5:before,.hack h6:before{display:inline}.hack h2:before{content:"## "}.hack h3:before{content:"### "}.hack h4:before{content:"#### "}.hack h5:before{content:"##### "}.hack h6:before{content:"###### "}.hack li{position:relative;display:block;padding-left:20px}.hack li:after{position:absolute;top:0;left:0}.hack ul>li:after{content:"-"}.hack ol{counter-reset:a}.hack ol>li:after{content:counter(a)".";counter-increment:a}.hack blockquote{position:relative;padding-left:17px;padding-left:2ch;overflow:hidden}.hack blockquote:after{content:">\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>";white-space:pre;position:absolute;top:0;left:0;line-height:20px}.hack em:after,.hack em:before{content:"*";display:inline}.hack pre code:after,.hack pre code:before{content:''}.hack code{font-weight:700}.hack code:after,.hack code:before{content:"`";display:inline}.hack hr{position:relative;height:20px;overflow:hidden;border:0;margin:20px 0}.hack hr:after{content:"----------------------------------------------------------------------------------------------------";position:absolute;top:0;left:0;line-height:20px;width:100%;word-wrap:break-word}@-moz-document url-prefix(){.hack h1{display:block}}.hack-ones ol>li:after{content:"1."}p{margin:0 0 1.75rem}.container{max-width:70rem}.container,.container-fluid{margin:0 auto;padding:0 1rem}.inner{padding:1rem}.inner2x{padding:2rem}.pull-left{float:left}.pull-right{float:right}.progress-bar{height:8px;opacity:.8;background-color:#ccc;margin-top:12px}.progress-bar.progress-bar-show-percent{margin-top:38px}.progress-bar-filled{background-color:gray;height:100%;transition:width .3s ease;position:relative;width:0}.progress-bar-filled:before{content:'';border:6px solid transparent;border-top-color:gray;position:absolute;top:-12px;right:-6px}.progress-bar-filled:after{color:gray;content:attr(data-filled);display:block;font-size:12px;white-space:nowrap;position:absolute;border:6px solid transparent;top:-38px;right:0;-ms-transform:translateX(50%);transform:translateX(50%)}table{width:100%;border-collapse:collapse;margin:1.75rem 0;color:#778087}table td,table th{vertical-align:top;border:1px solid #ccc;line-height:15px;padding:10px}table thead th{font-size:10px}table tbody td:first-child{font-weight:700;color:#333}.form{width:30rem}.form-group{margin-bottom:1.75rem;overflow:auto}.form-group label{border-bottom:2px solid #ccc;color:#333;width:10rem;display:inline-block;height:38px;line-height:38px;padding:0;float:left;position:relative}.form-group.form-success label{color:#4caf50!important;border-color:#4caf50!important}.form-group.form-warning label{color:#ff9800!important;border-color:#ff9800!important}.form-group.form-error label{color:#f44336!important;border-color:#f44336!important}.form-control{outline:none;border:none;border-bottom:2px solid #ccc;padding:.5rem 0;width:20rem;height:38px;background-color:transparent}.form-control:focus{border-color:#555}.form-group.form-textarea label:after{position:absolute;content:'';width:2px;background-color:#fff;right:-2px;top:0;bottom:0}textarea.form-control{height:auto;resize:none;padding:1rem 0;border-bottom:2px solid #ccc;border-left:2px solid #ccc;padding:.5rem}select.form-control{border-radius:0;background-color:transparent;-webkit-appearance:none;-moz-appearance:none;-ms-appearance:none}.help-block{color:#999;margin-top:.5rem}.form-actions{margin-bottom:1.75rem}.btn{display:-ms-inline-flexbox;display:inline-flex;-ms-flex-align:center;align-items:center;-ms-flex-pack:center;justify-content:center;cursor:pointer;outline:none;padding:.65rem 2rem;font-size:1rem;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;position:relative;z-index:1}.btn:active{box-shadow:inset 0 1px 3px rgba(0,0,0,.12)}.btn.btn-ghost{border-color:#757575;color:#757575;background-color:transparent}.btn.btn-ghost:focus,.btn.btn-ghost:hover{border-color:#424242;color:#424242;z-index:2}.btn.btn-ghost:hover{background-color:transparent}.btn-block{width:100%;display:-ms-flexbox;display:flex}.btn-default{color:#fff;background-color:#e0e0e0;border:1px solid #e0e0e0;color:#333}.btn-default:focus:not(.btn-ghost),.btn-default:hover{background-color:#dcdcdc;border-color:#dcdcdc}.btn-success{color:#fff;background-color:#4caf50;border:1px solid #4caf50}.btn-success:focus:not(.btn-ghost),.btn-success:hover{background-color:#43a047;border-color:#43a047}.btn-success.btn-ghost{border-color:#4caf50;color:#4caf50}.btn-success.btn-ghost:focus,.btn-success.btn-ghost:hover{border-color:#388e3c;color:#388e3c;z-index:2}.btn-error{color:#fff;background-color:#f44336;border:1px solid #f44336}.btn-error:focus:not(.btn-ghost),.btn-error:hover{background-color:#e53935;border-color:#e53935}.btn-error.btn-ghost{border-color:#f44336;color:#f44336}.btn-error.btn-ghost:focus,.btn-error.btn-ghost:hover{border-color:#d32f2f;color:#d32f2f;z-index:2}.btn-warning{color:#fff;background-color:#ff9800;border:1px solid #ff9800}.btn-warning:focus:not(.btn-ghost),.btn-warning:hover{background-color:#fb8c00;border-color:#fb8c00}.btn-warning.btn-ghost{border-color:#ff9800;color:#ff9800}.btn-warning.btn-ghost:focus,.btn-warning.btn-ghost:hover{border-color:#f57c00;color:#f57c00;z-index:2}.btn-info{color:#fff;background-color:#00bcd4;border:1px solid #00bcd4}.btn-info:focus:not(.btn-ghost),.btn-info:hover{background-color:#00acc1;border-color:#00acc1}.btn-info.btn-ghost{border-color:#00bcd4;color:#00bcd4}.btn-info.btn-ghost:focus,.btn-info.btn-ghost:hover{border-color:#0097a7;color:#0097a7;z-index:2}.btn-primary{color:#fff;background-color:#2196f3;border:1px solid #2196f3}.btn-primary:focus:not(.btn-ghost),.btn-primary:hover{background-color:#1e88e5;border-color:#1e88e5}.btn-primary.btn-ghost{border-color:#2196f3;color:#2196f3}.btn-primary.btn-ghost:focus,.btn-primary.btn-ghost:hover{border-color:#1976d2;color:#1976d2;z-index:2}.btn-group{overflow:auto}.btn-group .btn{float:left}.btn-group .btn-ghost:not(:first-child){margin-left:-1px}.card{border:1px solid #ccc}.card .card-header{color:#333;text-align:center;background-color:#ddd;padding:.5rem 0}.alert{color:#ccc;padding:1rem;border:1px solid #ccc;margin-bottom:1.75rem}.alert-success{color:#4caf50;border-color:#4caf50}.alert-error{color:#f44336;border-color:#f44336}.alert-info{color:#00bcd4;border-color:#00bcd4}.alert-warning{color:#ff9800;border-color:#ff9800}.media:not(:last-child){margin-bottom:1.25rem}.media-left{padding-right:1rem}.media-left,.media-right{display:table-cell;vertical-align:top}.media-right{padding-left:1rem}.media-body{display:table-cell;vertical-align:top}.media-heading{font-size:1.16667rem;font-weight:700}.media-content{margin-top:.3rem}.avatarholder,.placeholder{background-color:#f0f0f0;text-align:center;color:#b9b9b9;font-size:1rem;border:1px solid #f0f0f0}.avatarholder{width:48px;height:48px;line-height:46px;font-size:2rem;background-size:cover;background-position:50%;background-repeat:no-repeat}.avatarholder.rounded{border-radius:33px}.loading{height:20px;width:20px;animation:a .6s infinite linear;border:2px solid #e91e63;border-right-color:transparent;border-radius:50%}.btn .loading{display:inline-block;float:left;margin-right:.5rem;width:14px;height:14px}@keyframes a{0%{transform:rotate(0deg)}to{transform:rotate(1turn)}}.menu{width:100%}.menu .menu-item{display:block;color:#616161;border-color:#616161}.menu .menu-item.active,.menu .menu-item:hover{color:#000;border-color:#000;background-color:transparent}@media screen and (max-width:768px){.form-group label{display:block;border-bottom:none;width:100%}.form-group.form-textarea label:after{display:none}.form-control{width:100%}textarea.form-control{border-left:none;padding:.5rem 0}pre::-webkit-scrollbar{height:3px}}@media screen and (max-width:480px){.form{width:100%}}.dark{color:#ccc}.dark,.dark pre{background-color:#000}.dark pre{padding:0;border:none}.dark pre code{color:#00bcd4}.dark h1 a,.dark h2 a,.dark h3 a,.dark h4 a,.dark h5 a{color:#ccc}.dark code,.dark strong{color:#fff}.dark code{font-weight:100}.dark table{color:#ccc}.dark table td,.dark table th{border-color:#444}.dark table tbody td:first-child{color:#fff}.dark .form-group label{color:#ccc;border-color:rgba(95,95,95,.78)}.dark .form-group.form-textarea label:after{background-color:#000}.dark .form-control{color:#ccc;border-color:rgba(95,95,95,.78)}.dark .form-control:focus{border-color:#ccc;color:#ccc}.dark textarea.form-control{color:#ccc}.dark .card{border-color:rgba(95,95,95,.78)}.dark .card .card-header{background-color:transparent;color:#ccc;border-bottom:1px solid rgba(95,95,95,.78)}.dark .btn.btn-ghost.btn-default{border-color:#ababab;color:#ababab}.dark .btn.btn-ghost.btn-default:focus,.dark .btn.btn-ghost.btn-default:hover{border-color:#9c9c9c;color:#9c9c9c;z-index:1}.dark .btn.btn-ghost.btn-default:focus,.dark .btn.btn-ghost.btn-default:hover{border-color:#e0e0e0;color:#e0e0e0}.dark .btn.btn-ghost.btn-primary:focus,.dark .btn.btn-ghost.btn-primary:hover{border-color:#64b5f6;color:#64b5f6}.dark .btn.btn-ghost.btn-success:focus,.dark .btn.btn-ghost.btn-success:hover{border-color:#81c784;color:#81c784}.dark .btn.btn-ghost.btn-info:focus,.dark .btn.btn-ghost.btn-info:hover{border-color:#4dd0e1;color:#4dd0e1}.dark .btn.btn-ghost.btn-error:focus,.dark .btn.btn-ghost.btn-error:hover{border-color:#e57373;color:#e57373}.dark .btn.btn-ghost.btn-warning:focus,.dark .btn.btn-ghost.btn-warning:hover{border-color:#ffb74d;color:#ffb74d}.dark .avatarholder,.dark .placeholder{background-color:transparent;border-color:#333}.dark .menu .menu-item{color:#ccc;border-color:rgba(95,95,95,.78)}.dark .menu .menu-item.active,.dark .menu .menu-item:hover{color:#fff;border-color:#ccc}@keyframes intro{0%{opacity:0}100%{opacity:1}}.muted{color:rgba(255,255,255,.5)}iframe{border:0}main,footer{animation:intro .3s both;animation-delay:.15s}:target{color:#fff}.hack li ul{margin:0}.main{padding:20px 10px}nav a.active{background-color:#ff2e88;color:#fff}a[itemprop=url]{color:#ff9800}a[itemprop=url]:hover{color:#fff}html{font-size:13px}.hack pre{font-size:17px}article [itemprop=description]{margin-bottom:20px;margin-top:20px}@media screen and (min-width:768px){html{font-size:1em}.container{max-width:50rem}}</style></head><body class="hack dark main container"><header><nav itemscope itemtype=http://schema.org/SiteNavigationElement><a itemprop=url href=/><span itemprop=name>Home</span></a>
<a itemprop=url class=active href=/post/><span itemprop=name>Posts</span></a>
<a itemprop=url href=/tags/><span itemprop=name>Tags</span></a>
<a itemprop=url href=https://github.com/erdii><span itemprop=name>github</span></a>
<a itemprop=url href=https://keybase.io/erdii><span itemprop=name>keybase</span></a>
<a itemprop=url href=https://matrix.to/#/%40erdii%3awerise.de><span itemprop=name>matrix</span></a></nav></header><main><article itemscope itemtype=http://schema.org/BlogPosting><meta itemprop=name content="TIL: How to store and restore the state of multiple entities in Home Assistant"><meta itemprop=description content="Short howto: store/restore state in HA"><meta itemprop=datePublished content="2021-03-10T20:00:00+01:00"><meta itemprop=dateModified content="2021-03-10T20:00:00+01:00"><meta itemprop=wordCount content="443"><meta itemprop=keywords content="til,home-assistant,smart-home,"><header><h1 itemprop=headline>TIL: How to store and restore the state of multiple entities in Home Assistant</h1><p class=muted><svg style="margin-bottom:-3px" class="i-clock" viewBox="0 0 32 32" width="16" height="16" fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="6.25%"><circle cx="16" cy="16" r="14"/><path d="M16 8v8l4 4"/></svg><span>3 minute read</span><svg style="margin-bottom:-3px" class="i-edit" viewBox="0 0 32 32" width="16" height="16" fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="6.25%"><path d="M30 7 25 2 5 22 3 29l7-2zM21 6l5 5zM5 22l5 5z"/></svg>
Published: <time datetime=2021-03-10T20:00:00+01:00>10 Mar, 2021</time></p></header><blockquote itemprop=description>Short howto: store/restore state in HA</blockquote><div itemprop=articleBody><p>The problem: Automations sometimes need to store the state of several entities at once and then restore all of them at a later point in time.
An example of this is:</p><p>When I open my balcony door at night, I want the lights in my room to turn off.
when I close the balcony door, I want the lights to be restored to the exact same state they were previously.</p><p>Siytek&rsquo;s post brought up the idea that one can store states in a newly created scene, then change stuff and later activate the scene to restore everything. AMAZING!</p><p>The problem with their outlined approach: You need to exactly specify which states and attributes of which entities to store in the scene and this can quickly escalate when you want to keep track of multiple entities at once.</p><p>My solution: using a <a href=https://www.home-assistant.io/integrations/python_script/>python_script</a> to do all the heavy lifting. It only wants 2 things:</p><ol><li>the name of the scene to create</li><li>a list of all entities to store their state</li></ol><h2 id=dependencies>Dependencies</h2><ul><li><a href=https://www.home-assistant.io/>Home Assistant</a> Version: 2021.3.2</li><li>enabled <a href=https://www.home-assistant.io/integrations/python_script/>python_script integration</a></li></ul><h2 id=code>Code</h2><h3 id=python_scriptsstore_and_turn_offpy>python_scripts/store_and_turn_off.py</h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>entities <span style=color:#f92672>=</span> data<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;entities&#34;</span>, [])
scene <span style=color:#f92672>=</span> data<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;scene&#34;</span>, <span style=color:#e6db74>&#34;&#34;</span>)
logger<span style=color:#f92672>.</span>info(<span style=color:#e6db74>&#34;[store_and_turn_off]: [scene: &#39;</span><span style=color:#e6db74>%s</span><span style=color:#e6db74>&#39;] storing state for </span><span style=color:#e6db74>%s</span><span style=color:#e6db74>&#34;</span>, scene, entities)

scene_entities <span style=color:#f92672>=</span> {}

<span style=color:#66d9ef>for</span> entity <span style=color:#f92672>in</span> entities:
    state_wrapper <span style=color:#f92672>=</span> hass<span style=color:#f92672>.</span>states<span style=color:#f92672>.</span>get(entity)
    state_dict <span style=color:#f92672>=</span> state_wrapper<span style=color:#f92672>.</span>as_dict()
    stored_state <span style=color:#f92672>=</span> {
        <span style=color:#e6db74>&#34;state&#34;</span>: state_dict[<span style=color:#e6db74>&#34;state&#34;</span>],
        <span style=color:#f92672>**</span>state_dict[<span style=color:#e6db74>&#34;attributes&#34;</span>]
    }
    scene_entities[entity] <span style=color:#f92672>=</span> stored_state

scene_data <span style=color:#f92672>=</span> {
    <span style=color:#e6db74>&#34;scene_id&#34;</span>: scene,
    <span style=color:#e6db74>&#34;entities&#34;</span>: scene_entities
}

<span style=color:#66d9ef>if</span> len(entities) <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>:
    logger<span style=color:#f92672>.</span>info(<span style=color:#e6db74>&#34;[store_and_turn_off]: entities not set&#34;</span>)

<span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> scene:
    logger<span style=color:#f92672>.</span>info(<span style=color:#e6db74>&#34;[store_and_turn_off]: scene not set&#34;</span>)
<span style=color:#66d9ef>else</span>:
    hass<span style=color:#f92672>.</span>services<span style=color:#f92672>.</span>call(<span style=color:#e6db74>&#34;scene&#34;</span>, <span style=color:#e6db74>&#34;create&#34;</span>, scene_data, True)
    logger<span style=color:#f92672>.</span>info(<span style=color:#e6db74>&#34;[store_and_turn_off] stored state in scene </span><span style=color:#e6db74>%s</span><span style=color:#e6db74>&#34;</span>, scene)

<span style=color:#75715e># if you don&#39;t want this script to turn off stuff, then remove all following lines:</span>
turn_off_data <span style=color:#f92672>=</span> {
    <span style=color:#e6db74>&#34;entity_id&#34;</span>: entities
}

hass<span style=color:#f92672>.</span>services<span style=color:#f92672>.</span>call(<span style=color:#e6db74>&#34;homeassistant&#34;</span>, <span style=color:#e6db74>&#34;turn_off&#34;</span>, turn_off_data, True)
</code></pre></div><h2 id=example-usage>example usage</h2><p>When I open the office balcony door at night for longer than 1s,
the entities <code>light.office_whiteboard</code>, <code>light.office_woodboard</code>, <code>switch.office_light_switch</code>
will get their state stored in <code>scene.zz_office</code> and then be turned off.
When the door is closed again, their state will be restored again by activating <code>scene.zz_office</code></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#66d9ef>alias</span>: window_open_night_office
<span style=color:#66d9ef>mode</span>: single
<span style=color:#66d9ef>description</span>: <span style=color:#e6db74>&#39;&#39;</span>
<span style=color:#66d9ef>trigger</span>:
- <span style=color:#66d9ef>type</span>: opened
  <span style=color:#66d9ef>platform</span>: device
  <span style=color:#66d9ef>device_id</span>: ab0909b30b0a3
  <span style=color:#66d9ef>entity_id</span>: binary_sensor.lumi_lumi_sensor_magnet_aq2_on_off
  <span style=color:#66d9ef>domain</span>: binary_sensor
  <span style=color:#66d9ef>for</span>:
    <span style=color:#66d9ef>hours</span>: <span style=color:#ae81ff>0</span>
    <span style=color:#66d9ef>minutes</span>: <span style=color:#ae81ff>0</span>
    <span style=color:#66d9ef>seconds</span>: <span style=color:#ae81ff>1</span>
    <span style=color:#66d9ef>milliseconds</span>: <span style=color:#ae81ff>0</span>
<span style=color:#66d9ef>condition</span>: <span style=color:#75715e># Only run this automation when it&#39;s dark outside // the sun is under the horizon</span>
- <span style=color:#66d9ef>condition</span>: template
  <span style=color:#66d9ef>value_template</span>: <span style=color:#e6db74>&#39;{{ state_attr(&#39;&#39;sun.sun&#39;&#39;, &#39;&#39;elevation&#39;&#39;) &lt; 0 }}&#39;</span>
<span style=color:#66d9ef>action</span>:
- <span style=color:#66d9ef>service</span>: python_script.store_and_turn_off
  <span style=color:#66d9ef>data</span>:
    <span style=color:#66d9ef>scene</span>: zz_office
    <span style=color:#66d9ef>entities</span>:
    - light.office_whiteboard
    - light.office_woodboard
    - switch.office_light_switch
- <span style=color:#66d9ef>wait_for_trigger</span>:
  - <span style=color:#66d9ef>type</span>: not_opened
    <span style=color:#66d9ef>platform</span>: device
    <span style=color:#66d9ef>device_id</span>: ab0909b30b0a3
    <span style=color:#66d9ef>entity_id</span>: binary_sensor.lumi_lumi_sensor_magnet_aq2_on_off
    <span style=color:#66d9ef>domain</span>: binary_sensor
- <span style=color:#66d9ef>service</span>: scene.turn_on
  <span style=color:#66d9ef>target</span>:
    <span style=color:#66d9ef>entity_id</span>: scene.zz_office
</code></pre></div><p>Sidenote: I prefix the scene names with <code>zz_</code> to make sure that they will not pollute my list of automations.</p><p>This solution is heavily inspired by <a href=https://siytek.com/remember-state-in-home-assistant/>Siytek&rsquo;s blog post</a>!</p></div><footer><hr><p>Published
<time datetime=2021-03-10T20:00:00+01:00>10 Mar, 2021</time>
in <span itemprop=articleSection><a href=/categories//></a></span>and tagged <a href=/tags/home-assistant/>home-assistant</a>, <a href=/tags/smart-home/>smart-home</a> and <a href=/tags/til/>til</a>
using <span itemprop=wordCount>443</span> words.</p><aside><header>Related Content</header><ul><li><a href=/post/2019-06-03-til-how-to-prevent-a-package-from-updating-on-ubuntu/>TIL: How to prevent a package from updating on ubuntu</a> &ndash; 1 minutes<li><a href=/post/2019-03-31-til-how-to-update-all-package-json-dependencies-at-once/>TIL: How to update all package.json dependencies at once</a> &ndash; 1 minutes<li><a href=/post/2018-09-26-til-how-to-count-git-commits-by-author-name/>TIL how to count git commits in a repository by author name</a> &ndash; 1 minutes<li><a href=/post/2017-03-21-til-how-to-use-caddy-as-automatic-https-reverse-proxy/>TIL how to use caddy as automatic https reverse proxy</a> &ndash; 1 minutes<li><a href=/2016/03/30/til-how-to-run-postgresql-in-docker-and-persist-the-database/>TIL how to run postgresql in docker and persist the database</a> &ndash; 1 minutes<li><a href=/2016/03/23/til-how-to-re-enable-syncing-your-shared-google-calendars/>TIL how to (re)enable syncing your shared google calendars</a> &ndash; 1 minutes<li><a href=/2016/03/22/til-how-to-rename-or-move-folders-in-git-projects/>TIL how to rename/move folders in git projects</a> &ndash; 1 minutes</ul></aside></footer></article></main><footer><p class=muted>This page was generated using After Dark for
<a target=_blank rel=noopener href=https://gohugo.io/>Hugo</a>.</p></footer></body></html>